{% load url from future %}
<script src="{% static 'js/jquery.form.js' %}'"></script>

<div class="commit popUp">
  <h2>Commit Changes</h2>
  {% if changed_anything %}
    <form method="post" class="commit_form" action="{{ commit_url }}">
      {% csrf_token %}
      {% for field in form %}
        {% include "widgy/field_as_div.html" %}
      {% endfor %}
      
      <p class="submitRow">
        <input type="submit" value="Commit">
      {# TODO: this is dependent on widgy_mezzanine #}
        <a class="button" href="{% url 'widgy.contrib.widgy_mezzanine.views.preview' node_pk=object.working_copy.pk %}">Preview</a>
      {% if diff_url %}
        <a class="button" href="{{ diff_url }}">Diff</a>
      {% endif %}
      </p>
    </form>
    <script>
      $('.commit_form').ajaxForm({target: 'div.commit'});
    </script>
  {% else %}
    <p>Nothing has changed -- no need to commit.</p>
  {% endif %}
</div>
</body>
